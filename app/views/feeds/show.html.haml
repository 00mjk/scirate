- provide :title, @title

.split

.container.feed-page
  .row-fluid
    .span2.sidebar.left
      %ul.nav.nav-list.tree-sidebar.feedbar
        - if signed_in?
          %li.my-feeds
            %label.tree-toggler.nav-header My feeds
            %ul.nav.nav-list.tree
              - current_user.feeds.each do |feed|
                %li.leaf
                  = link_to(feed.fullname, feed)

        %li.source-heading arXiv.org
        - Feed.find_all_by_name(['astro-ph', 'cond-mat', 'nlin', 'physics', 'math', 'cs', 'q-bio', 'q-fin', 'stat']).each do |parent|
          %li
            %label.tree-toggler.nav-header= parent.fullname
            %ul.nav.nav-list.tree{ style: (@feed == parent || @feed.parent == parent) ? '' : 'display: none;' }
              - if parent.last_paper_date
                %li.leaf.parent{class: @feed == parent && 'active'}= link_to(parent.fullname, parent)
              - parent.children.each do |feed|
                %li.leaf{class: @feed == feed && 'active'}= link_to(feed.fullname, feed)

        - Feed.find_all_by_name(['gr-qc', 'hep-ex', 'hep-lat', 'hep-ph', 'hep-th', 'math-ph', 'nucl-ex', 'nucl-th', 'quant-ph']).each do |feed|
          %li.leaf{ class: @feed == feed && 'active' }= link_to(feed.fullname, feed)

    .span10.feed-center
      %header.feed-header
        .row-fluid
          .span10
            %h1= @feed.fullname
          .span2
            = render 'feeds/subscribe', :feed => @feed
      %p
        Found #{@papers.count} papers from #{describe_range(@date, @range)}
        %span.feed-identifier
          [#{@feed.identifier}]
      .paperlist
        %ul.papers
          - if @papers.length == 0
            - if @feed.nil? && signed_in? && !current_user.has_subscriptions?
              %p You haven't subscribed to any feeds yet! Papers from subscribed feeds will appear here.
            - else
              %p No papers found!
          - else
            = render @papers
      = will_paginate @papers
      \&nbsp;

      -#
        .span3.feed-rightbar
          = render :partial => 'feeds/next_prev_links'
          %h3 Recent comments
          = render :partial => "comments/abbr_comment", :collection => @recent_comments[0..9]
