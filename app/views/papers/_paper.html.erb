<% cool_paper = paper.scites_count > 0 || (@search && [@search.conditions[:abstract], @search.general_term].find { |t| t && paper.abstract.include?(t) }) %>

<% unless defined?(showabs) %>
  <% showabs = cool_paper || (current_user && current_user.expand_abstracts) %>
<% end %>

<li class="paper tex2jax">
  <div class="row">
    <div class="col-md-9">
      <div class="title">
        <a href="<%= url_for(paper) %>">
          <% if @search %>
            <%= highlight(paper.title, [@search.conditions[:title], @search.general_term].reject { |t| t.nil? }) %>
          <% else %>
            <%= paper.title %>
          <% end %>
        </a>
      </div>
      <div class="authors">
        <% paper.authors[0..19].each do |author| %>
          <%= author_link_to(author) + (author != paper.authors[-1] ? "," : ' ') %>
        <% end %>
        <% if paper.authors.length > 20 %>
          <a class="expand-authors">et al (<%= paper.authors.length - 20 %>)</a>
          <span class="more-authors hidden">
            <% paper.authors[20..-1].each do |author| %>
              <%= author_link_to(author) + (author != paper.authors[-1] ? "," : ' ') %>
            <% end %>
          </span>
        <% end %>
      </div>
      <span class="uid">
        <%= paper.pubdate.strftime("%b %d %Y") %>
        <% for feed in paper.feeds %>
          <%= link_to feed.uid, feed %>
        <% end %>
      </span>
    </div>
    <div class="col-md-3">
      <div class="pull-right">
        <%= render 'scites/toggle', paper: paper %>
        <a class="paper-download btn btn-default" title="Download PDF" href="<%= paper.pdf_url %>"><i class="fa fa-download"></i></a>
        <% if paper.comments_count > 0 %>
          <div><a href="<%= url_for(paper) %>"><%= pluralize paper.comments_count, 'comment' %></a></div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="abstract<% unless showabs %> hidden<% end %><% unless cool_paper %> hideable<% end %>">
    <% if @search %>
      <%= highlight(paper.abstract, [@search.conditions[:abstract], @search.general_term].reject(&:nil?)) %>
    <% else %>
      <%= paper.abstract %>
    <% end %>
  </div>
</li>
